---
title: "Covid91 vaccine study Final2023"
author: "Monserrat Mendez!"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
OldData <-read.csv(file="final.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- OldData %>% mutate(infected = recode(infected, aids = "covid", none = "OK" )) %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
FinalData$treatment <- relevel(FinalData$treatment,ref="placebo")
#FinalData$infected <- relevel(FinalData$infected,ref="OK")
males = filter(FinalData, sex =="M")
females = filter(FinalData, sex =="F")
LGBTQ = filter(FinalData, LGBTQ =="gay")
Druggies = filter(FinalData, DrugUser =="yes")
```

# Introduction

A new  preventative vaccine (covid921) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.

# oding details 

First, the character variables in FinalData were changed to factor variables using appropriate dplyr code.


```{r}
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
```

The study required specific subgroups to be isolated from the broader categories in order to be properly analyzed. For instance, "females" and "males" were separated into subgroups, as were people who identified as having a gay sexual orientation and those who answered "yes" to participating in drug use. These categories were examined in isolation to determine whether or not these particular populations should take the new COVID-19 vaccine. To create the effectiveness interval for each of the four categories, each group of people in this study had to be 

## Males

### Barplot



```{r}
dd2 <- males %>% group_by(infected, treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))

# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity", position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100, fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

This plot represents the population of male people and the relationship to the contraction of covid-19 by either talking the vaccine or the placebo. 


The plot above shows that 38% of the people that took the vaccine did in fact get covid-19, while only approximately 69% of the people taking the placebo contracted covid-19.  A substantially higher percentage of people who took tha vaccine contracted covid-19 versus those who were only given the placebo. The vaccine appears to be ineffective in protection against covid-19. The odds of getting covid-19 while taking the vaccine is 2.25:1. The men that took the vaccine were 2.25 less likely to get covid-19 than those taking the placebo.


There are two plots. In first plot,the x-axis represents infected, whether the participants were infected with covid-19 or they were not. The y-axis represents the count, or number of people that got covid-19 or not.
In the second plot, the one above, The The left two bars of the graph are all the people that got covid-19. The x-axis represents whether a person got covid-19 or not. The y-axis, however, instead of representing the number of people who got covid-19, now represents the percentage of people that got covid-19 after taking the the placebo or taking the Vaccine. 


The codes that  create this plot start with the code block beginning with dd2. dd2 can be seen in the environment pane and if inspected contains 4 variables.These variables include infected, treatment, count, and prcent(stands for percent). The second group of codes is called the basicC. BasicC can also be seen in the environment pane and appears to contain a list of 9 variables. This information creates the first plot. The basicCC is the last bunch of codes and is also in the files pane. It also contains 9 variables and helps to create the percentage plot, the second plot.I also used Taylor's examples and changed the code from "guys" to "males" to match up my date 


### Numerical results

```{r}
table1 <- xtabs(~infected + treatment, data=males)
rowPerc(table1)
colPerc(table1)
```
The plots and numerical results show taht 69% of Males got covid talking the placebo and only 30% got covid after getting the vaccine. A significantly larger percentage of those who took the placebo contracted covid-19 than those who got the vaccine. The vaccine appears to provide more protection against Covid-19. The odds of not getting covid-19 while talking the vaccine is 2.25.1 The Male that took the vaccine were 2.25 times less likely to get covid-19 than taking the placebo. 


### Inferential 



```{r}
chisq.test(table1)
chisqtestGC(table1)
Malesfish <- fisher.test(table1)
Malesfish
```



```{r}
effect <- Malesfish$p.value/(Malesfish$p.value +1)
effectivenessguy = Malesfish$estimate/(Malesfish$estimate +1)*100
print(effectivenessguy)
```

```{r}
low=(Malesfish$conf.int[1]/(Malesfish$conf.int[1] +1))*100
hi=(Malesfish$conf.int[2]/(Malesfish$conf.int[2] +1))*100
options(digits=2)
```



## Effectiveness Confidence Interval `r low`  to `r hi`

## Females

### Barplot

```{r}
dd2 <- females %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

```{r}
table1 <- xtabs(~infected + treatment, data=females)
rowPerc(table1)
colPerc(table1)
```
### Inferential 




```{r}
chisq.test(table1)
chisqtestGC(table1)
femalesfish <- fisher.test(table1)
femalesfish
```

```{r}
effect <- femalesfish$p.value/(femalesfish$p.value +1)
effectivenessfemales = femalesfish$estimate/(femalesfish$estimate +1)*100
print(effectivenessfemales)
```

```{r}
low=(femalesfish$conf.int[1]/(femalesfish$conf.int[1] +1))*100
hi=(femalesfish$conf.int[2]/(femalesfish$conf.int[2] +1))*100
options(digits=2)
```

## Effectiveness Confidence Interval `r low`  to `r hi`



## LGBTQ

### Barplot

```{r}
dd2 <- LGBTQ %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```
### Numerical results

```{r}
table1 <- xtabs(~infected + treatment, data=LGBTQ)
rowPerc(table1)
colPerc(table1)
```

### Inferential 




```{r}
chisq.test(table1)
chisqtestGC(table1)
LGBTQfish <- fisher.test(table1)
LGBTQfish
```

```{r}
effect <- LGBTQfish$p.value/(LGBTQfish$p.value +1)
effectivenessLGBTQ = LGBTQfish$estimate/(LGBTQfish$estimate +1)*100
print(effectivenessLGBTQ)
```

```{r}
low=(LGBTQfish$conf.int[1]/(LGBTQfish$conf.int[1] +1))*100
hi=(LGBTQfish$conf.int[2]/(LGBTQfish$conf.int[2] +1))*100
options(digits=2)
```





## Effectiveness Confidence Interval `r low`  to `r hi`

## Druggies

```{r}
dd2 <-  Druggies %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

### Numerical results

```{r}
table1 <- xtabs(~infected + treatment, data= Druggies)
rowPerc(table1)
colPerc(table1)
```
### Inferential 


```{r}
chisq.test(table1)
chisqtestGC(table1)
Druggiesfish <- fisher.test(table1)
Druggiesfish
```


```{r}
effect <- drugfish$p.value/(drugfish$p.value +1)
effectivenessdrug = drugfish$estimate/(drugfish$estimate +1)*100
print(effectivenessdrug)
```

```{r}
low=(drugfish$conf.int[1]/(drugfish$conf.int[1] +1))*100
hi=(drugfish$conf.int[2]/(drugfish$conf.int[2] +1))*100
options(digits=2)
```

## Effectiveness Confidence Interval `r low`  to `r hi`



# Overall Results and Conclusions






